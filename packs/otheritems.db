{"name":"Shaman","type":"trait","img":"systems/wfrp4e/icons/blank.png","effects":[{"_id":"vtHQSj1XPWKSu7U2","changes":[],"disabled":false,"duration":{"startTime":null,"seconds":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"icon":"systems/wfrp4e/icons/blank.png","label":"Shaman","transfer":true,"flags":{"wfrp4e":{"effectTrigger":"oneTime","effectApplication":"actor","hide":false,"preventDuplicateEffects":false,"script":"let characteristics = {\n    \"ws\" : 0,\n    \"bs\" : 0,\n    \"s\" : 0,\n    \"t\" : 5,\n    \"i\" : 15,\n    \"ag\" : 0,\n    \"dex\" : 10,\n    \"int\" : 15,\n    \"wp\" : 15,\n    \"fel\" : 0\n}\nlet skills = [\"Channelling\", \"Cool\", \"Dodge\", \"Entertain (Storytelling)\", \"Intuition\", \"Language (Magick)\", \"Lore (Magic)\", \"Perception\"]\nlet skillAdvancements = [5, 15, 10, 10, 15, 10, 10, 20]\nlet talents = [\"Arcane Magic\", \"Petty Magic\", \"Second Sight\"]\nlet trappings = [\"Hand Weapon\", \"Quarterstaff\", \"Ritual Dress incorporating many ingredients and fetishes\"]\nlet items = [];\n\nlet updateObj = this.actor.toObject();\n\nfor (let ch in characteristics)\n{\n    updateObj.data.characteristics[ch].modifier += characteristics[ch];\n}\n\nfor (let index = 0; index < skills.length; index++)\n{\n    let skill = skills[index]\n    let skillItem;\n    skillItem = updateObj.items.find(i => i.name == skill && i.type == \"skill\")\n    if (skillItem)\n        skillItem.data.advances.value += skillAdvancements[index]\n    else \n    {\n        skillItem = await game.wfrp4e.utility.findSkill(skill)\n        skillItem = skillItem.toObject();\n        skillItem.data.advances.value = skillAdvancements[index];\n        items.push(skillItem);\n    }\n}\n\nfor (let talent of talents)\n{\n    let talentItem = await game.wfrp4e.utility.findTalent(talent)\n    if (talentItem)\n    {\n        items.push(talentItem.toObject());\n    }\n    else \n    {\n        ui.notifications.warn(`Could not find ${talent}`, {permanent : true})\n    }\n}\n\nfor (let trapping of trappings) \n{\n    let trappingItem = await game.wfrp4e.utility.findItem(trapping)\n    if (trappingItem)\n    {\n        trappingItem = trappingItem.toObject()\n\n        equip(trappingItem)\n\n        items.push(trappingItem);\n    }\n    else \n    {\n        items.push({name : trapping, type : \"trapping\", \"data.trappingType.value\" : \"clothingAccessories\"})\n        //ui.notifications.warn(`Could not find ${trapping}`, {permanent : true})\n    }\n}\n\nupdateObj.name = updateObj.name += \" \" + this.effect.label\n\nawait this.actor.update(updateObj)\nthis.actor.createEmbeddedDocuments(\"Item\", items);\n\nfunction equip(item)\n{\n    if (item.type == \"armour\")\n        item.data.worn.value = true\n    else if (item.type == \"weapon\")\n        item.data.equipped = true\n    else if (item.type == \"trapping\" && item.data.trappingType.value == \"clothingAccessories\")\n        item.data.worn = true\n}"}},"tint":null,"origin":null},{"_id":"qAvOQQOsNHVDhUZZ","changes":[],"disabled":false,"duration":{"startTime":null,"seconds":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"icon":"systems/wfrp4e/icons/blank.png","label":"Skill Choice","transfer":true,"flags":{"wfrp4e":{"effectTrigger":"oneTime","effectApplication":"actor","hide":false,"preventDuplicateEffects":false,"script":"let choice1 = [\n    {\n        type : \"skill\",\n        name : \"Melee (Basic)\",\n        diff : {\n            data : {\n                advances : {\n                    value : 10\n                }\n            }\n        }\n    }\n]\nlet choice2 = [\n    {\n        type : \"skill\",\n        name : \"Melee (Polearm)\",\n        diff : {\n            data : {\n                advances : {\n                    value : 10\n                }\n            }\n        }\n    }\n]\n\nlet choice = await new Promise((resolve, reject) => {\n    new Dialog({\n        title : \"Choice\",\n        content : \n        `<p>\n        Select your choice\n        </p>\n        <ol>\n        <li>Melee (Basic)</li>\n        <li>Melee (Polearm)</li>\n        </ol> \n        `,\n        buttons : {\n            1 : {\n                label : \"Basic\",\n                callback : () => {\n                    resolve(choice1)\n                }\n            },\n            2 : {\n                label : \"Polearm\",\n                callback : () => {\n                    resolve(choice2)\n                }\n            }\n        }\n    }).render(true)\n}) \n\nlet updateObj = this.actor.toObject();\nlet items = []\nfor (let c of choice)\n{\n    let existing \n    if (c.type == \"skill\")\n    {\n        existing = updateObj.items.find(i => i.name == c.name && i.type == c.type)\n        if (existing && c.diff?.data?.advances?.value)\n        {\n            existing.data.advances.value += c.diff.data.advances.value\n        }\n    }\n\n    if (!existing)\n    {\n        let item = await game.wfrp4e.utility.find(c.name, c.type)\n        if (item)\n        {\n            item = item.toObject()\n            equip(item);\n                items.push(mergeObject(item, (c.diff || {})))\n        }\n        else\n            ui.notifications.warn(`Could not find ${talent}`, {permanent : true})\n    }\n\n}\nawait this.actor.update(updateObj)\nthis.actor.createEmbeddedDocuments(\"Item\", items);\n\nfunction equip(item)\n{\n    if (item.type == \"armour\")\n        item.data.worn.value = true\n    else if (item.type == \"weapon\")\n        item.data.equipped = true\n    else if (item.type == \"trapping\" && item.data.trappingType.value == \"clothingAccessories\")\n        item.data.worn = true\n}"}},"tint":null,"origin":null},{"_id":"eGmLTRChIZWsa90P","changes":[],"disabled":false,"duration":{"startTime":null,"seconds":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"icon":"systems/wfrp4e/icons/blank.png","label":"Spell Choice","transfer":true,"flags":{"wfrp4e":{"effectTrigger":"oneTime","effectApplication":"actor","hide":false,"preventDuplicateEffects":false,"script":"let filters = [\n    {\n        property : \"type\",\n        value : \"spell\"\n    },\n    {\n        property : \"data.lore.value\",\n        value : \"petty\"\n    }\n]\n\nlet petty = await game.wfrp4e.apps.ItemDialog.createFromFilters(filters, 3, \"Choose 3 Petty Spells\")\n\n\nfilters = [\n    {\n        property : \"type\",\n        value : \"spell\"\n    },\n    {\n        property : \"data.lore.value\",\n        value : \"\"\n    }\n]\n\nlet arcane = await game.wfrp4e.apps.ItemDialog.createFromFilters(filters, 3, \"Choose 3 Arcane Spells\")\n\nlet items = petty.concat(arcane).map(i => i.toObject())\n\nthis.actor.createEmbeddedDocuments(\"Item\", items);"}},"tint":null,"origin":null}],"flags":{"wfrp4e-owb1":{"initialization-folder":"Templates","sort":300000},"core":{"sourceId":"Compendium.wfrp4e-owb1.items.2MLTmxqyThixeZDo"}},"system":{"description":{"type":"String","label":"Description","value":"<p>Petty magicians and mystics, a Shaman acts as the spiritual advisor of the warband, guiding their Chiefs and assisting in warfare with their crude but powerful spells.</p>"},"gmdescription":{"type":"String","label":"Description","value":""},"rollable":{"value":false,"damage":false,"skill":"","label":"Rollable","type":"Boolean","rollCharacteristic":"","bonusCharacteristic":"","dice":"","defaultDifficulty":"challenging","SL":true,"attackType":"melee"},"specification":{"value":"","type":"String","label":"Specification"},"qualities":{"label":"Qualities","value":[]},"flaws":{"label":"Flaws","value":[]}},"_stats":{"systemId":"wfrp4e","systemVersion":"6.5.9","coreVersion":"10.303","createdTime":1688304220224,"modifiedTime":1688304220224,"lastModifiedBy":"QnM952ZqoCxWL1Ok"},"_id":"2MLTmxqyThixeZDo","folder":null,"sort":0,"ownership":{"default":0,"QnM952ZqoCxWL1Ok":3}}
{"name":"Warlord","type":"trait","img":"systems/wfrp4e/icons/blank.png","effects":[{"_id":"GPWvWnhtvfc1jdvJ","changes":[],"disabled":false,"duration":{"startTime":null,"seconds":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"icon":"systems/wfrp4e/icons/blank.png","label":"Warlord","transfer":true,"flags":{"wfrp4e":{"effectTrigger":"oneTime","effectApplication":"actor","hide":false,"preventDuplicateEffects":false,"script":"let characteristics = {\n    \"ws\" : 35,\n    \"bs\" : 10,\n    \"s\" : 25,\n    \"t\" : 30,\n    \"i\" : 30,\n    \"ag\" : 25,\n    \"dex\" : 0,\n    \"int\" : 15,\n    \"wp\" : 35,\n    \"fel\" : 15\n}\nlet skills = [\"Cool\", \"Dodge\", \"Intimidate\", \"Intuition\", \"Leadership\", \"Lore (Warfare)\", \"Perception\"]\nlet skillAdvancements = [25, 15, 25, 25, 30, 20, 20]\nlet talents = [\"Combat Aware\", \"Combat Reflexes\", \"Feint\", \"Inspiring\", \"Luck\", \"Resolute\", \"Unshakable\", \"War Leader\"]\nlet trappings = [\"Hand Weapon\", \"Shield\"]\nlet items = [];\n\nlet updateObj = this.actor.toObject();\n\nfor (let ch in characteristics)\n{\n    updateObj.data.characteristics[ch].modifier += characteristics[ch];\n}\n\nfor (let index = 0; index < skills.length; index++)\n{\n    let skill = skills[index]\n    let skillItem;\n    skillItem = updateObj.items.find(i => i.name == skill && i.type == \"skill\")\n    if (skillItem)\n        skillItem.data.advances.value += skillAdvancements[index]\n    else \n    {\n        skillItem = await game.wfrp4e.utility.findSkill(skill)\n        skillItem = skillItem.toObject();\n        skillItem.data.advances.value = skillAdvancements[index];\n        items.push(skillItem);\n    }\n}\n\nfor (let talent of talents)\n{\n    let talentItem = await game.wfrp4e.utility.findTalent(talent)\n    if (talentItem)\n    {\n        items.push(talentItem.toObject());\n    }\n    else \n    {\n        ui.notifications.warn(`Could not find ${talent}`, {permanent : true})\n    }\n}\n\nfor (let trapping of trappings) \n{\n    let trappingItem = await game.wfrp4e.utility.findItem(trapping)\n    if (trappingItem)\n    {\n        trappingItem = trappingItem.toObject()\n\n        equip(trappingItem)\n\n        items.push(trappingItem);\n    }\n    else \n    {\n        ui.notifications.warn(`Could not find ${trapping}`, {permanent : true})\n    }\n}\n\nupdateObj.name = updateObj.name += \" \" + this.effect.label\n\nawait this.actor.update(updateObj)\nthis.actor.createEmbeddedDocuments(\"Item\", items);\n\nfunction equip(item)\n{\n    if (item.type == \"armour\")\n        item.data.worn.value = true\n    else if (item.type == \"weapon\")\n        item.data.equipped = true\n    else if (item.type == \"trapping\" && item.data.trappingType.value == \"clothingAccessories\")\n        item.data.worn = true\n}"}},"tint":null,"origin":null},{"_id":"AuJTlxoXcNzVmzBD","changes":[],"disabled":false,"duration":{"startTime":null,"seconds":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"icon":"systems/wfrp4e/icons/blank.png","label":"Armour Choice","transfer":true,"flags":{"wfrp4e":{"effectTrigger":"oneTime","effectApplication":"actor","hide":false,"preventDuplicateEffects":false,"script":"let choice1 = [\n    {\n        type : \"armour\",\n        name : \"Mail Chausses\"\n    },\n    {\n        type : \"armour\",\n        name : \"Mail Coat\"\n    },\n    {\n        type : \"armour\",\n        name : \"Mail Coif\"\n    },\n]\nlet choice2 = [\n    {\n        type : \"armour\",\n        name : \"Mail Chausses\"\n    },\n    {\n        type : \"armour\",\n        name : \"Mail Coat\"\n    },\n    {\n        type : \"armour\",\n        name : \"Mail Coif\"\n    },\n    {\n        type : \"armour\",\n        name : \"Leather Leggings\"\n    },\n    {\n        type : \"armour\",\n        name : \"Leather Skullcap\"\n    },\n    {\n        type : \"armour\",\n        name : \"Leather Jack\"\n    },\n]\nlet choice3 = [\n    {\n        type : \"armour\",\n        name : \"Plate Breastplate\"\n    },\n    {\n        type : \"armour\",\n        name : \"Plate Bracers\"\n    },\n    {\n        type : \"armour\",\n        name : \"Plate Helm\"\n    },\n    {\n        type : \"armour\",\n        name : \"Plate Leggings\"\n    },\n]\n\nlet choice = await new Promise((resolve, reject) => {\n    new Dialog({\n        title : \"Choice\",\n        content : \n        `<p>\n        Select your choice\n        </p>\n        <ol>\n        <li>Mail</li>\n        <li>Mail & Leather</li>\n        <li>Plate</li>\n        </ol> \n        `,\n        buttons : {\n            1 : {\n                label : \"Mail\",\n                callback : () => {\n                    resolve(choice1)\n                }\n            },\n            2 : {\n                label : \"Mail & Leather\",\n                callback : () => {\n                    resolve(choice2)\n                }\n            },\n            3 : {\n                label : \"Plate\",\n                callback : () => {\n                    resolve(choice3)\n                }\n            }\n        }\n    }).render(true)\n}) \n\nlet updateObj = this.actor.toObject();\nlet items = []\nfor (let c of choice)\n{\n    let existing \n    if (c.type == \"skill\")\n    {\n        existing = updateObj.items.find(i => i.name == c.name && i.type == c.type)\n        if (existing && c.diff?.data?.advances?.value)\n        {\n            existing.data.advances.value += c.diff.data.advances.value\n        }\n    }\n\n    if (!existing)\n    {\n        let item = await game.wfrp4e.utility.find(c.name, c.type)\n        if (item)\n        {\n            item = item.toObject()\n            equip(item);\n                items.push(mergeObject(item, (c.diff || {})))\n        }\n        else\n            ui.notifications.warn(`Could not find ${c.name}`, {permanent : true})\n    }\n\n}\nawait this.actor.update(updateObj)\nthis.actor.createEmbeddedDocuments(\"Item\", items);\n\nfunction equip(item)\n{\n    if (item.type == \"armour\")\n        item.data.worn.value = true\n    else if (item.type == \"weapon\")\n        item.data.equipped = true\n    else if (item.type == \"trapping\" && item.data.trappingType.value == \"clothingAccessories\")\n        item.data.worn = true\n}"}},"tint":null,"origin":null},{"_id":"jFGjaXME7naMExvp","changes":[],"disabled":false,"duration":{"startTime":null,"seconds":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"icon":"systems/wfrp4e/icons/blank.png","label":"Option","transfer":true,"flags":{"wfrp4e":{"effectTrigger":"oneTime","effectApplication":"actor","hide":false,"preventDuplicateEffects":false,"script":"let choice1 = [\n    {\n        type : \"skill\",\n        name : \"Ranged (Bow)\",\n        diff : {\n            data : {\n                advances : {\n                    value : 10\n                }\n            }\n        }\n    },\n    {\n        type : \"weapon\",\n        name : \"Longbow\",\n    },\n    {\n        type : \"ammunition\",\n        name : \"Arrow\",\n    }\n]\nlet choice2 = [\n]\n\nlet choice = await new Promise((resolve, reject) => {\n    new Dialog({\n        title : \"Option\",\n        content : \n        `<p>\n        Add Option?\n        </p>\n        <ol>\n        <li>Ranged (Bow) +10 and a Longbow with 12 Arrows</li>\n        </ol> \n        `,\n        buttons : {\n            1 : {\n                label : \"Yes\",\n                callback : () => {\n                    resolve(choice1)\n                }\n            },\n            2 : {\n                label : \"No\",\n                callback : () => {\n                    resolve(choice2)\n                }\n            }\n        }\n    }).render(true)\n}) \n\nlet updateObj = this.actor.toObject();\nlet items = []\nfor (let c of choice)\n{\n    let existing \n    if (c.type == \"skill\")\n    {\n        existing = updateObj.items.find(i => i.name == c.name && i.type == c.type)\n        if (existing && c.diff?.data?.advances?.value)\n        {\n            existing.data.advances.value += c.diff.data.advances.value\n        }\n    }\n\n    if (!existing)\n    {\n        let item = await game.wfrp4e.utility.find(c.name, c.type)\n        if (item)\n        {\n            item = item.toObject()\n            equip(item);\n                items.push(mergeObject(item, (c.diff || {})))\n        }\n        else\n            ui.notifications.warn(`Could not find ${talent}`, {permanent : true})\n    }\n\n}\nawait this.actor.update(updateObj)\nthis.actor.createEmbeddedDocuments(\"Item\", items);\n\nfunction equip(item)\n{\n    if (item.type == \"armour\")\n        item.data.worn.value = true\n    else if (item.type == \"weapon\")\n        item.data.equipped = true\n    else if (item.type == \"trapping\" && item.data.trappingType.value == \"clothingAccessories\")\n        item.data.worn = true\n}"}},"tint":null,"origin":null},{"_id":"ZECDPbfIFDoxAUva","changes":[],"disabled":false,"duration":{"startTime":null,"seconds":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"icon":"systems/wfrp4e/icons/blank.png","label":"Weapon Choice","transfer":true,"flags":{"wfrp4e":{"effectTrigger":"oneTime","effectApplication":"actor","hide":false,"preventDuplicateEffects":false,"script":"let filters = [\n    {\n        property : \"type\",\n        value : \"weapon\"\n    },\n    {\n        property : \"data.weaponGroup.value\",\n        value : [\"twohanded\", \"polearm\"]\n    }\n]\n\nlet items = await game.wfrp4e.apps.ItemDialog.createFromFilters(filters, 1, \"Choose an appropriate Polearm or Two-Handed Weapon\")\nitems = items.map(i => i.toObject())\n\nitems.forEach(i => equip(i))\n\nthis.actor.createEmbeddedDocuments(\"Item\", items);\n\nfunction equip(item)\n{\n    if (item.type == \"armour\")\n        item.data.worn.value = true\n    else if (item.type == \"weapon\")\n        item.data.equipped = true\n    else if (item.type == \"trapping\" && item.data.trappingType.value == \"clothingAccessories\")\n        item.data.worn = true\n}"}},"tint":null,"origin":null},{"_id":"BuEdZRUCWdaks7Td","changes":[],"disabled":false,"duration":{"startTime":null,"seconds":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"icon":"systems/wfrp4e/icons/blank.png","label":"Skill Choice","transfer":true,"flags":{"wfrp4e":{"effectTrigger":"oneTime","effectApplication":"actor","hide":false,"preventDuplicateEffects":false,"script":"let filters = [\n    {\n        property : \"type\",\n        value : \"skill\"\n    },\n    {\n        property : \"name\",\n        value : /Melee/gm,\n        regex: true\n    }\n]\n\nlet items = await game.wfrp4e.apps.ItemDialog.createFromFilters(filters, 2, \"Choose 2 Skills to add +20\")\nitems = items.map(i => i.toObject())\nitems.forEach(i => i.data.advances.value = 20)\n\nthis.actor.createEmbeddedDocuments(\"Item\", items);"}},"tint":null,"origin":null}],"flags":{"core":{"sourceId":"Item.kAMXgJUDGOAKJ01T"},"wfrp4e-owb1":{"initialization-folder":"Templates","sort":700000}},"system":{"description":{"type":"String","label":"Description","value":"<p>The Warlord may rule over a single tribe in a particular vicinity, or may command a coalition of allied or vassalised bands over a wider region.</p>"},"gmdescription":{"type":"String","label":"Description","value":""},"rollable":{"value":false,"damage":false,"skill":"","label":"Rollable","type":"Boolean","rollCharacteristic":"","bonusCharacteristic":"","dice":"","defaultDifficulty":"challenging","SL":true,"attackType":"melee"},"specification":{"value":"","type":"String","label":"Specification"},"qualities":{"label":"Qualities","value":[]},"flaws":{"label":"Flaws","value":[]}},"_stats":{"systemId":"wfrp4e","systemVersion":"6.5.9","coreVersion":"10.303","createdTime":1688304247299,"modifiedTime":1688304247299,"lastModifiedBy":"QnM952ZqoCxWL1Ok"},"_id":"8tiCsLtqpWmfJSIm","folder":null,"sort":0,"ownership":{"default":0,"QnM952ZqoCxWL1Ok":3}}
{"name":"Skirmisher","type":"trait","img":"systems/wfrp4e/icons/blank.png","effects":[{"_id":"vtHQSj1XPWKSu7U2","changes":[],"disabled":false,"duration":{"startTime":null,"seconds":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"icon":"systems/wfrp4e/icons/blank.png","label":"Skirmisher","transfer":true,"flags":{"wfrp4e":{"effectTrigger":"oneTime","effectApplication":"actor","hide":false,"preventDuplicateEffects":false,"script":"let characteristics = {\n    \"ws\" : 0,\n    \"bs\" : 5,\n    \"s\" : 0,\n    \"t\" : 0,\n    \"i\" : 10,\n    \"ag\" : 10,\n    \"dex\" : 0,\n    \"int\" : 0,\n    \"wp\" : 5,\n    \"fel\" : 0\n}\nlet skills = [\"Dodge\", \"Perception\"]\nlet skillAdvancements = [10, 10]\nlet talents = [\"Flee!\", \"Marksman\"]\nlet trappings = [\"Hand Weapon\"]\nlet items = [];\n\nlet updateObj = this.actor.toObject();\n\nfor (let ch in characteristics)\n{\n    updateObj.data.characteristics[ch].modifier += characteristics[ch];\n}\n\nfor (let index = 0; index < skills.length; index++)\n{\n    let skill = skills[index]\n    let skillItem;\n    skillItem = updateObj.items.find(i => i.name == skill && i.type == \"skill\")\n    if (skillItem)\n        skillItem.data.advances.value += skillAdvancements[index]\n    else \n    {\n        skillItem = await game.wfrp4e.utility.findSkill(skill)\n        skillItem = skillItem.toObject();\n        skillItem.data.advances.value = skillAdvancements[index];\n        items.push(skillItem);\n    }\n}\n\nfor (let talent of talents)\n{\n    let talentItem = await game.wfrp4e.utility.findTalent(talent)\n    if (talentItem)\n    {\n        items.push(talentItem.toObject());\n    }\n    else \n    {\n        ui.notifications.warn(`Could not find ${talent}`, {permanent : true})\n    }\n}\n\nfor (let trapping of trappings) \n{\n    let trappingItem = await game.wfrp4e.utility.findItem(trapping)\n    if (trappingItem)\n    {\n        trappingItem = trappingItem.toObject()\n\n        equip(trappingItem)\n\n        items.push(trappingItem);\n    }\n    else \n    {\n        ui.notifications.warn(`Could not find ${trapping}`, {permanent : true})\n    }\n}\n\nupdateObj.name = updateObj.name += \" \" + this.effect.label\n\nawait this.actor.update(updateObj)\nthis.actor.createEmbeddedDocuments(\"Item\", items);\n\nfunction equip(item)\n{\n    if (item.type == \"armour\")\n        item.data.worn.value = true\n    else if (item.type == \"weapon\")\n        item.data.equipped = true\n    else if (item.type == \"trapping\" && item.data.trappingType.value == \"clothingAccessories\")\n        item.data.worn = true\n}"}},"tint":null,"origin":null},{"_id":"qAvOQQOsNHVDhUZZ","changes":[],"disabled":false,"duration":{"startTime":null,"seconds":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"icon":"systems/wfrp4e/icons/blank.png","label":"Skill Choice","transfer":true,"flags":{"wfrp4e":{"effectTrigger":"oneTime","effectApplication":"actor","hide":false,"preventDuplicateEffects":false,"script":"let choice1 = [\n    {\n        type : \"skill\",\n        name : \"Ranged (Bow)\",\n        diff : {\n            data : {\n                advances : {\n                    value : 10\n                }\n            }\n        }\n    },\n    {\n        type : \"weapon\",\n        name : \"Bow\",\n    },\n    {\n        type : \"ammunition\",\n        name : \"Arrow\",\n    }\n]\nlet choice2 = [\n    {\n        type : \"skill\",\n        name : \"Ranged (Sling)\",\n        diff : {\n            data : {\n                advances : {\n                    value : 10\n                }\n            }\n        }\n    },\n    {\n        type : \"weapon\",\n        name : \"Sling\",\n    },\n    {\n        type : \"ammunition\",\n        name : \"Stone Bullet\",\n    }\n]\n\nlet choice = await new Promise((resolve, reject) => {\n    new Dialog({\n        title : \"Choice\",\n        content : \n        `<p>\n        Select your choice\n        </p>\n        <ol>\n        <li>Ranged (Bow)</li>\n        <li>Ranged (Sling)</li>\n        </ol> \n        <p>Skill choice comes with appropriate weapon and ammo</p>\n        `,\n        buttons : {\n            1 : {\n                label : \"Bow\",\n                callback : () => {\n                    resolve(choice1)\n                }\n            },\n            2 : {\n                label : \"Sling\",\n                callback : () => {\n                    resolve(choice2)\n                }\n            }\n        }\n    }).render(true)\n}) \n\nlet updateObj = this.actor.toObject();\nlet items = []\nfor (let c of choice)\n{\n    let existing \n    if (c.type == \"skill\")\n    {\n        existing = updateObj.items.find(i => i.name == c.name && i.type == c.type)\n        if (existing && c.diff?.data?.advances?.value)\n        {\n            existing.data.advances.value += c.diff.data.advances.value\n        }\n    }\n\n    if (!existing)\n    {\n        let item = await game.wfrp4e.utility.find(c.name, c.type)\n        if (item)\n        {\n            item = item.toObject()\n            equip(item);\n                items.push(mergeObject(item, (c.diff || {})))\n        }\n        else\n            ui.notifications.warn(`Could not find ${talent}`, {permanent : true})\n    }\n\n}\nawait this.actor.update(updateObj)\nthis.actor.createEmbeddedDocuments(\"Item\", items);\n\nfunction equip(item)\n{\n    if (item.type == \"armour\")\n        item.data.worn.value = true\n    else if (item.type == \"weapon\")\n        item.data.equipped = true\n    else if (item.type == \"trapping\" && item.data.trappingType.value == \"clothingAccessories\")\n        item.data.worn = true\n}"}},"tint":null,"origin":null}],"flags":{"core":{"sourceId":"Item.TP91Bx8K4PUbNKFH"},"wfrp4e-owb1":{"initialization-folder":"Templates","sort":500000}},"system":{"description":{"type":"String","label":"Description","value":"<p>Most tribes include a caste of warriors practised in sneak attacks, harassing enemies with missile fire, and providing skilled lookouts</p>"},"gmdescription":{"type":"String","label":"Description","value":""},"rollable":{"value":false,"damage":false,"skill":"","label":"Rollable","type":"Boolean","rollCharacteristic":"","bonusCharacteristic":"","dice":"","defaultDifficulty":"challenging","SL":true,"attackType":"melee"},"specification":{"value":"","type":"String","label":"Specification"},"qualities":{"label":"Qualities","value":[]},"flaws":{"label":"Flaws","value":[]}},"_stats":{"systemId":"wfrp4e","systemVersion":"6.5.9","coreVersion":"10.303","createdTime":1688304222250,"modifiedTime":1688304222250,"lastModifiedBy":"QnM952ZqoCxWL1Ok"},"_id":"B9jHNeXqabZZeBkT","folder":null,"sort":0,"ownership":{"default":0,"QnM952ZqoCxWL1Ok":3}}
{"name":"Reformed Rogue","type":"trait","img":"systems/wfrp4e/icons/blank.png","effects":[{"_id":"GPWvWnhtvfc1jdvJ","changes":[],"disabled":false,"duration":{"startTime":null,"seconds":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"icon":"systems/wfrp4e/icons/blank.png","label":"Reformed Rogue","transfer":true,"flags":{"wfrp4e":{"effectTrigger":"oneTime","effectApplication":"actor","hide":false,"preventDuplicateEffects":false,"script":" let characteristics = {\n                    \"ws\" : 5,\n                    \"bs\" : 0,\n                    \"s\" : 0,\n                    \"t\" : 0,\n                    \"i\" : 0,\n                    \"ag\" : 10,\n                    \"dex\" : 10,\n                    \"int\" : 0,\n                    \"wp\" : 0,\n                    \"fel\" : 5\n                }\n                let skills = [\"Perception\", \"Sleight of Hand\", \"Stealth (Urban)\"]\n                let skillAdvancements = [10, 10, 10]\n                let talents = [\"Criminal\", \"Etiquette (Criminals)\"]\n                let trappings = [\"Rope, 10 yards\", \"Lockpick\", \"Mask\"]\n                let items = []\n        \n                let updateObj = this.actor.toObject();\n                \n                for (let ch in characteristics)\n                {\n                    updateObj.system.characteristics[ch].modifier += characteristics[ch];\n                }\n                \n                for (let index = 0; index < skills.length; index++)\n                {\n                    let skill = skills[index]\n                    let skillItem;\n                    skillItem = updateObj.items.find(i => i.name == skill && i.type == \"skill\")\n                    if (skillItem)\n                        skillItem.system.advances.value += skillAdvancements[index]\n                    else \n                    {\n                        skillItem = await game.wfrp4e.utility.findSkill(skill)\n                        skillItem = skillItem.toObject();\n                        skillItem.system.advances.value = skillAdvancements[index];\n                        items.push(skillItem);\n                    }\n                }\n                \n                for (let talent of talents)\n                {\n                    let talentItem = await game.wfrp4e.utility.findTalent(talent)\n                    if (talentItem)\n                    {\n                        items.push(talentItem.toObject());\n                    }\n                    else \n                    {\n                        ui.notifications.warn(`Could not find ${talent}`, {permanent : true})\n                    }\n                }\n                \n                for (let trapping of trappings) \n                {\n                    let trappingItem = await game.wfrp4e.utility.findItem(trapping)\n                    if (trappingItem)\n                    {\n                        trappingItem = trappingItem.toObject()\n                \n                        equip(trappingItem)\n                \n                        items.push(trappingItem);\n                    }\n                    else \n                    {\n                        ui.notifications.warn(`Could not find ${trapping}`, {permanent : true})\n                    }\n                }\n              \n                \n                await this.actor.update(updateObj)\n                this.actor.createEmbeddedDocuments(\"Item\", items);\n                \n                function equip(item)\n                {\n                    if (item.type == \"armour\")\n                        item.system.worn.value = true\n                    else if (item.type == \"weapon\")\n                        item.system.equipped = true\n                    else if (item.type == \"trapping\" && item.system.trappingType.value == \"clothingAccessories\")\n                        item.system.worn = true\n                }"}},"tint":null,"origin":null}],"flags":{"core":{"sourceId":"Item.kAMXgJUDGOAKJ01T"},"wfrp4e-owb1":{"initialization-folder":"Templates","sort":100000},"wfrp4e-up-in-arms":{"initialization-folder":"Templates","sort":500000}},"system":{"description":{"type":"String","label":"Description","value":""},"gmdescription":{"type":"String","label":"Description","value":""},"rollable":{"value":false,"damage":false,"skill":"","label":"Rollable","type":"Boolean","rollCharacteristic":"","bonusCharacteristic":"","dice":"","defaultDifficulty":"challenging","SL":true,"attackType":"melee"},"specification":{"value":"","type":"String","label":"Specification"},"qualities":{"label":"Qualities","value":[]},"flaws":{"label":"Flaws","value":[]}},"_stats":{"systemId":"wfrp4e","systemVersion":"6.5.9","coreVersion":"10.303","createdTime":1670793141344,"modifiedTime":1688303628864,"lastModifiedBy":"QnM952ZqoCxWL1Ok"},"_id":"IS3LTdTuay6uRHUq","folder":null,"sort":0,"ownership":{"default":0,"QnM952ZqoCxWL1Ok":3}}
{"name":"Old Salt","type":"trait","img":"systems/wfrp4e/icons/blank.png","effects":[{"_id":"GPWvWnhtvfc1jdvJ","changes":[],"disabled":false,"duration":{"startTime":null,"seconds":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"icon":"systems/wfrp4e/icons/blank.png","label":"Old Salt","transfer":true,"flags":{"wfrp4e":{"effectTrigger":"oneTime","effectApplication":"actor","hide":false,"preventDuplicateEffects":false,"script":"        let characteristics = {\n            \"ws\" : 0,\n            \"bs\" : 0,\n            \"s\" : 10,\n            \"t\" : 10,\n            \"i\" : 0,\n            \"ag\" : 10,\n            \"dex\" : 0,\n            \"int\" : 0,\n            \"wp\" : 0,\n            \"fel\" : 0\n        }\n        let skills = [\"Consume Alcohol\", \"Row\", \"Sail\", \"Swim\"]\n        let skillAdvancements = [10, 10, 10, 10]\n        let talents = []\n        let trappings = []\n        let items = []\n\n        let updateObj = this.actor.toObject();\n        \n        for (let ch in characteristics)\n        {\n            updateObj.system.characteristics[ch].modifier += characteristics[ch];\n        }\n        \n        for (let index = 0; index < skills.length; index++)\n        {\n            let skill = skills[index]\n            let skillItem;\n            skillItem = updateObj.items.find(i => i.name == skill && i.type == \"skill\")\n            if (skillItem)\n                skillItem.system.advances.value += skillAdvancements[index]\n            else \n            {\n                skillItem = await game.wfrp4e.utility.findSkill(skill)\n                skillItem = skillItem.toObject();\n                skillItem.system.advances.value = skillAdvancements[index];\n                items.push(skillItem);\n            }\n        }\n        \n        for (let talent of talents)\n        {\n            let talentItem = await game.wfrp4e.utility.findTalent(talent)\n            if (talentItem)\n            {\n                items.push(talentItem.toObject());\n            }\n            else \n            {\n                ui.notifications.warn(`Could not find ${talent}`, {permanent : true})\n            }\n        }\n        \n        for (let trapping of trappings) \n        {\n            let trappingItem = await game.wfrp4e.utility.findItem(trapping)\n            if (trappingItem)\n            {\n                trappingItem = trappingItem.toObject()\n        \n                equip(trappingItem)\n        \n                items.push(trappingItem);\n            }\n            else \n            {\n                ui.notifications.warn(`Could not find ${trapping}`, {permanent : true})\n            }\n        }\n       \n        \n        await this.actor.update(updateObj)\n        this.actor.createEmbeddedDocuments(\"Item\", items);\n        \n        function equip(item)\n        {\n            if (item.type == \"armour\")\n                item.system.worn.value = true\n            else if (item.type == \"weapon\")\n                item.system.equipped = true\n            else if (item.type == \"trapping\" && item.system.trappingType.value == \"clothingAccessories\")\n                item.system.worn = true\n        }"}},"tint":null,"origin":null}],"flags":{"core":{"sourceId":"Item.kAMXgJUDGOAKJ01T"},"wfrp4e-owb1":{"initialization-folder":"Templates","sort":100000},"wfrp4e-up-in-arms":{"initialization-folder":"Templates","sort":350000}},"system":{"description":{"type":"String","label":"Description","value":""},"gmdescription":{"type":"String","label":"Description","value":""},"rollable":{"value":false,"damage":false,"skill":"","label":"Rollable","type":"Boolean","rollCharacteristic":"","bonusCharacteristic":"","dice":"","defaultDifficulty":"challenging","SL":true,"attackType":"melee"},"specification":{"value":"","type":"String","label":"Specification"},"qualities":{"label":"Qualities","value":[]},"flaws":{"label":"Flaws","value":[]}},"_stats":{"systemId":"wfrp4e","systemVersion":"6.5.9","coreVersion":"10.303","createdTime":1670793141344,"modifiedTime":1688303577563,"lastModifiedBy":"QnM952ZqoCxWL1Ok"},"_id":"LjMlx99gBGeRJUQu","folder":null,"sort":0,"ownership":{"default":0,"QnM952ZqoCxWL1Ok":3}}
{"name":"Chief","type":"trait","img":"systems/wfrp4e/icons/blank.png","effects":[{"_id":"GPWvWnhtvfc1jdvJ","changes":[],"disabled":false,"duration":{"startTime":null,"seconds":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"icon":"systems/wfrp4e/icons/blank.png","label":"Chief","transfer":true,"flags":{"wfrp4e":{"effectTrigger":"oneTime","effectApplication":"actor","hide":false,"preventDuplicateEffects":false,"script":"let characteristics = {\n    \"ws\" : 25,\n    \"bs\" : 10,\n    \"s\" : 15,\n    \"t\" : 15,\n    \"i\" : 25,\n    \"ag\" : 20,\n    \"dex\" : 0,\n    \"int\" : 10,\n    \"wp\" : 25,\n    \"fel\" : 10\n}\nlet skills = [\"Cool\", \"Dodge\", \"Intimidate\", \"Intuition\", \"Leadership\", \"Lore (Warfare)\", \"Perception\"]\nlet skillAdvancements = [15, 15, 15, 15, 15, 10, 10]\nlet talents = [\"Combat Aware\", \"Combat Reflexes\", \"Feint\", \"Inspiring\", \"Resolute\", \"War Leader\"]\nlet trappings = [\"Hand Weapon\", \"Shield\"]\nlet items = [];\n\nlet updateObj = this.actor.toObject();\n\nfor (let ch in characteristics)\n{\n    updateObj.data.characteristics[ch].modifier += characteristics[ch];\n}\n\nfor (let index = 0; index < skills.length; index++)\n{\n    let skill = skills[index]\n    let skillItem;\n    skillItem = updateObj.items.find(i => i.name == skill && i.type == \"skill\")\n    if (skillItem)\n        skillItem.data.advances.value += skillAdvancements[index]\n    else \n    {\n        skillItem = await game.wfrp4e.utility.findSkill(skill)\n        skillItem = skillItem.toObject();\n        skillItem.data.advances.value = skillAdvancements[index];\n        items.push(skillItem);\n    }\n}\n\nfor (let talent of talents)\n{\n    let talentItem = await game.wfrp4e.utility.findTalent(talent)\n    if (talentItem)\n    {\n        items.push(talentItem.toObject());\n    }\n    else \n    {\n        ui.notifications.warn(`Could not find ${talent}`, {permanent : true})\n    }\n}\n\nfor (let trapping of trappings) \n{\n    let trappingItem = await game.wfrp4e.utility.findItem(trapping)\n    if (trappingItem)\n    {\n        trappingItem = trappingItem.toObject()\n\n        equip(trappingItem)\n\n        items.push(trappingItem);\n    }\n    else \n    {\n        ui.notifications.warn(`Could not find ${trapping}`, {permanent : true})\n    }\n}\n\nupdateObj.name = updateObj.name += \" \" + this.effect.label\n\nawait this.actor.update(updateObj)\nthis.actor.createEmbeddedDocuments(\"Item\", items);\n\nfunction equip(item)\n{\n    if (item.type == \"armour\")\n        item.data.worn.value = true\n    else if (item.type == \"weapon\")\n        item.data.equipped = true\n    else if (item.type == \"trapping\" && item.data.trappingType.value == \"clothingAccessories\")\n        item.data.worn = true\n}"}},"tint":null,"origin":null},{"_id":"AuJTlxoXcNzVmzBD","changes":[],"disabled":false,"duration":{"startTime":null,"seconds":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"icon":"systems/wfrp4e/icons/blank.png","label":"Armour Choice","transfer":true,"flags":{"wfrp4e":{"effectTrigger":"oneTime","effectApplication":"actor","hide":false,"preventDuplicateEffects":false,"script":"let choice1 = [\n    {\n        type : \"armour\",\n        name : \"Mail Chausses\"\n    },\n    {\n        type : \"armour\",\n        name : \"Mail Coat\"\n    },\n    {\n        type : \"armour\",\n        name : \"Mail Coif\"\n    },\n]\nlet choice2 = [\n    {\n        type : \"armour\",\n        name : \"Mail Chausses\"\n    },\n    {\n        type : \"armour\",\n        name : \"Mail Coat\"\n    },\n    {\n        type : \"armour\",\n        name : \"Mail Coif\"\n    },\n    {\n        type : \"armour\",\n        name : \"Leather Leggings\"\n    },\n    {\n        type : \"armour\",\n        name : \"Leather Skullcap\"\n    },\n    {\n        type : \"armour\",\n        name : \"Leather Jack\"\n    },\n]\nlet choice3 = [\n    {\n        type : \"armour\",\n        name : \"Plate Breastplate\"\n    },\n    {\n        type : \"armour\",\n        name : \"Plate Bracers\"\n    },\n    {\n        type : \"armour\",\n        name : \"Plate Helm\"\n    },\n    {\n        type : \"armour\",\n        name : \"Plate Leggings\"\n    },\n]\n\nlet choice = await new Promise((resolve, reject) => {\n    new Dialog({\n        title : \"Choice\",\n        content : \n        `<p>\n        Select your choice\n        </p>\n        <ol>\n        <li>Mail</li>\n        <li>Mail & Leather</li>\n        <li>Plate</li>\n        </ol> \n        `,\n        buttons : {\n            1 : {\n                label : \"Mail\",\n                callback : () => {\n                    resolve(choice1)\n                }\n            },\n            2 : {\n                label : \"Mail & Leather\",\n                callback : () => {\n                    resolve(choice2)\n                }\n            },\n            3 : {\n                label : \"Plate\",\n                callback : () => {\n                    resolve(choice3)\n                }\n            }\n        }\n    }).render(true)\n}) \n\nlet updateObj = this.actor.toObject();\nlet items = []\nfor (let c of choice)\n{\n    let existing \n    if (c.type == \"skill\")\n    {\n        existing = updateObj.items.find(i => i.name == c.name && i.type == c.type)\n        if (existing && c.diff?.data?.advances?.value)\n        {\n            existing.data.advances.value += c.diff.data.advances.value\n        }\n    }\n\n    if (!existing)\n    {\n        let item = await game.wfrp4e.utility.find(c.name, c.type)\n        if (item)\n        {\n            item = item.toObject()\n            equip(item);\n                items.push(mergeObject(item, (c.diff || {})))\n        }\n        else\n            ui.notifications.warn(`Could not find ${c.name}`, {permanent : true})\n    }\n\n}\nawait this.actor.update(updateObj)\nthis.actor.createEmbeddedDocuments(\"Item\", items);\n\nfunction equip(item)\n{\n    if (item.type == \"armour\")\n        item.data.worn.value = true\n    else if (item.type == \"weapon\")\n        item.data.equipped = true\n    else if (item.type == \"trapping\" && item.data.trappingType.value == \"clothingAccessories\")\n        item.data.worn = true\n}"}},"tint":null,"origin":null},{"_id":"jFGjaXME7naMExvp","changes":[],"disabled":false,"duration":{"startTime":null,"seconds":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"icon":"systems/wfrp4e/icons/blank.png","label":"Option","transfer":true,"flags":{"wfrp4e":{"effectTrigger":"oneTime","effectApplication":"actor","hide":false,"preventDuplicateEffects":false,"script":"let choice1 = [\n    {\n        type : \"skill\",\n        name : \"Ranged (Bow)\",\n        diff : {\n            data : {\n                advances : {\n                    value : 10\n                }\n            }\n        }\n    },\n    {\n        type : \"weapon\",\n        name : \"Bow\",\n    },\n    {\n        type : \"ammunition\",\n        name : \"Arrow\",\n    }\n]\nlet choice2 = [\n]\n\nlet choice = await new Promise((resolve, reject) => {\n    new Dialog({\n        title : \"Option\",\n        content : \n        `<p>\n        Add Option?\n        </p>\n        <ol>\n        <li>Ranged (Bow) +10 and a Bow with 12 Arrows</li>\n        </ol> \n        `,\n        buttons : {\n            1 : {\n                label : \"Yes\",\n                callback : () => {\n                    resolve(choice1)\n                }\n            },\n            2 : {\n                label : \"No\",\n                callback : () => {\n                    resolve(choice2)\n                }\n            }\n        }\n    }).render(true)\n}) \n\nlet updateObj = this.actor.toObject();\nlet items = []\nfor (let c of choice)\n{\n    let existing \n    if (c.type == \"skill\")\n    {\n        existing = updateObj.items.find(i => i.name == c.name && i.type == c.type)\n        if (existing && c.diff?.data?.advances?.value)\n        {\n            existing.data.advances.value += c.diff.data.advances.value\n        }\n    }\n\n    if (!existing)\n    {\n        let item = await game.wfrp4e.utility.find(c.name, c.type)\n        if (item)\n        {\n            item = item.toObject()\n            equip(item);\n                items.push(mergeObject(item, (c.diff || {})))\n        }\n        else\n            ui.notifications.warn(`Could not find ${talent}`, {permanent : true})\n    }\n\n}\nawait this.actor.update(updateObj)\nthis.actor.createEmbeddedDocuments(\"Item\", items);\n\nfunction equip(item)\n{\n    if (item.type == \"armour\")\n        item.data.worn.value = true\n    else if (item.type == \"weapon\")\n        item.data.equipped = true\n    else if (item.type == \"trapping\" && item.data.trappingType.value == \"clothingAccessories\")\n        item.data.worn = true\n}"}},"tint":null,"origin":null},{"_id":"y5lZLHlRcXljQtk3","changes":[],"disabled":false,"duration":{"startTime":null,"seconds":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"icon":"systems/wfrp4e/icons/blank.png","label":"Weapon Choice","transfer":true,"flags":{"wfrp4e":{"effectTrigger":"oneTime","effectApplication":"actor","hide":false,"preventDuplicateEffects":false,"script":"let filters = [\n    {\n        property : \"type\",\n        value : \"weapon\"\n    },\n    {\n        property : \"data.weaponGroup.value\",\n        value : [\"twohanded\", \"polearm\"]\n    }\n]\n\nlet items = await game.wfrp4e.apps.ItemDialog.createFromFilters(filters, 1, \"Choose an appropriate Polearm or Two-Handed Weapon\")\nitems = items.map(i => i.toObject())\n\nitems.forEach(i => equip(i))\n\nthis.actor.createEmbeddedDocuments(\"Item\", items);\n\nfunction equip(item)\n{\n    if (item.type == \"armour\")\n        item.data.worn.value = true\n    else if (item.type == \"weapon\")\n        item.data.equipped = true\n    else if (item.type == \"trapping\" && item.data.trappingType.value == \"clothingAccessories\")\n        item.data.worn = true\n}"}},"tint":null,"origin":null},{"_id":"65mmlSrpaGzLowYh","changes":[],"disabled":false,"duration":{"startTime":null,"seconds":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"icon":"systems/wfrp4e/icons/blank.png","label":"Skill Choice","transfer":true,"flags":{"wfrp4e":{"effectTrigger":"oneTime","effectApplication":"actor","hide":false,"preventDuplicateEffects":false,"script":"let filters = [\n    {\n        property : \"type\",\n        value : \"skill\"\n    },\n    {\n        property : \"name\",\n        value : /Melee/gm,\n        regex: true\n    }\n]\n\nlet items = await game.wfrp4e.apps.ItemDialog.createFromFilters(filters, 2, \"Choose 2 Skills to add +20\")\nitems = items.map(i => i.toObject())\nitems.forEach(i => i.data.advances.value = 20)\n\nthis.actor.createEmbeddedDocuments(\"Item\", items);"}},"tint":null,"origin":null}],"flags":{"core":{"sourceId":"Item.kAMXgJUDGOAKJ01T"},"wfrp4e-owb1":{"initialization-folder":"Templates","sort":100000}},"system":{"description":{"type":"String","label":"Description","value":"<p>A Chief may lead a small warband, or be subordinate to the warlord in a larger one. They are experienced warriors who rule mostly by their intimidating reputation.</p>"},"gmdescription":{"type":"String","label":"Description","value":""},"rollable":{"value":false,"damage":false,"skill":"","label":"Rollable","type":"Boolean","rollCharacteristic":"","bonusCharacteristic":"","dice":"","defaultDifficulty":"challenging","SL":true,"attackType":"melee"},"specification":{"value":"","type":"String","label":"Specification"},"qualities":{"label":"Qualities","value":[]},"flaws":{"label":"Flaws","value":[]}},"_stats":{"systemId":"wfrp4e","systemVersion":"6.5.9","coreVersion":"10.303","createdTime":1688304267302,"modifiedTime":1688304267302,"lastModifiedBy":"QnM952ZqoCxWL1Ok"},"_id":"P3r1pQsYRzGorZcb","folder":null,"sort":0,"ownership":{"default":0,"QnM952ZqoCxWL1Ok":3}}
{"name":"Soldier","type":"trait","img":"systems/wfrp4e/icons/blank.png","effects":[{"_id":"vtHQSj1XPWKSu7U2","changes":[],"disabled":false,"duration":{"startTime":null,"seconds":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"icon":"systems/wfrp4e/icons/blank.png","label":"Soldier","transfer":true,"flags":{"wfrp4e":{"effectTrigger":"oneTime","effectApplication":"actor","hide":false,"preventDuplicateEffects":false,"script":"let characteristics = {\n    \"ws\" : 5,\n    \"bs\" : 0,\n    \"s\" : 5,\n    \"t\" : 5,\n    \"i\" : 10,\n    \"ag\" : 0,\n    \"dex\" : 0,\n    \"int\" : 0,\n    \"wp\" : 5,\n    \"fel\" : 5\n}\nlet skills = [\"Cool\", \"Dodge\"]\nlet skillAdvancements = [10, 10]\nlet talents = [\"Combat Reflexes\", \"Resolute\"]\nlet trappings = [\"Leather Jack\", \"Leather Leggings\", \"Leather Skullcap\", \"Hand Weapon\", \"Spear\", \"Shield\"]\nlet items = [];\n\nlet updateObj = this.actor.toObject();\n\nfor (let ch in characteristics)\n{\n    updateObj.data.characteristics[ch].modifier += characteristics[ch];\n}\n\nfor (let index = 0; index < skills.length; index++)\n{\n    let skill = skills[index]\n    let skillItem;\n    skillItem = updateObj.items.find(i => i.name == skill && i.type == \"skill\")\n    if (skillItem)\n        skillItem.data.advances.value += skillAdvancements[index]\n    else \n    {\n        skillItem = await game.wfrp4e.utility.findSkill(skill)\n        skillItem = skillItem.toObject();\n        skillItem.data.advances.value = skillAdvancements[index];\n        items.push(skillItem);\n    }\n}\n\nfor (let talent of talents)\n{\n    let talentItem = await game.wfrp4e.utility.findTalent(talent)\n    if (talentItem)\n    {\n        items.push(talentItem.toObject());\n    }\n    else \n    {\n        ui.notifications.warn(`Could not find ${talent}`, {permanent : true})\n    }\n}\n\nfor (let trapping of trappings) \n{\n    let trappingItem = await game.wfrp4e.utility.findItem(trapping)\n    if (trappingItem)\n    {\n        trappingItem = trappingItem.toObject()\n\n        equip(trappingItem)\n\n        items.push(trappingItem);\n    }\n    else \n    {\n        ui.notifications.warn(`Could not find ${trapping}`, {permanent : true})\n    }\n}\n\nupdateObj.name = updateObj.name += \" \" + this.effect.label\n\nawait this.actor.update(updateObj)\nthis.actor.createEmbeddedDocuments(\"Item\", items);\n\n\nfunction equip(item)\n{\n    if (item.type == \"armour\")\n        item.data.worn.value = true\n    else if (item.type == \"weapon\")\n        item.data.equipped = true\n    else if (item.type == \"trapping\" && item.data.trappingType.value == \"clothingAccessories\")\n        item.data.worn = true\n}"}},"tint":null,"origin":null},{"_id":"qAvOQQOsNHVDhUZZ","changes":[],"disabled":false,"duration":{"startTime":null,"seconds":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"icon":"systems/wfrp4e/icons/blank.png","label":"Skill Choice","transfer":true,"flags":{"wfrp4e":{"effectTrigger":"oneTime","effectApplication":"actor","hide":false,"preventDuplicateEffects":false,"script":"let choice1 = [\n    {\n        type : \"skill\",\n        name : \"Melee (Basic)\",\n        diff : {\n            data : {\n                advances : {\n                    value : 10\n                }\n            }\n        }\n    }\n]\nlet choice2 = [\n    {\n        type : \"skill\",\n        name : \"Melee (Polearm)\",\n        diff : {\n            data : {\n                advances : {\n                    value : 10\n                }\n            }\n        }\n    }\n]\n\nlet choice = await new Promise((resolve, reject) => {\n    new Dialog({\n        title : \"Choice\",\n        content : \n        `<p>\n        Select your choice\n        </p>\n        <ol>\n        <li>Melee (Basic)</li>\n        <li>Melee (Polearm)</li>\n        </ol> \n        `,\n        buttons : {\n            1 : {\n                label : \"Basic\",\n                callback : () => {\n                    resolve(choice1)\n                }\n            },\n            2 : {\n                label : \"Polearm\",\n                callback : () => {\n                    resolve(choice2)\n                }\n            }\n        }\n    }).render(true)\n}) \n\nlet updateObj = this.actor.toObject();\nlet items = []\nfor (let c of choice)\n{\n    let existing \n    if (c.type == \"skill\")\n    {\n        existing = updateObj.items.find(i => i.name == c.name && i.type == c.type)\n        if (existing && c.diff?.data?.advances?.value)\n        {\n            existing.data.advances.value += c.diff.data.advances.value\n        }\n    }\n\n    if (!existing)\n    {\n        let item = await game.wfrp4e.utility.find(c.name, c.type)\n        if (item)\n        {\n            item = item.toObject()\n            equip(item);\n                items.push(mergeObject(item, (c.diff || {})))\n        }\n        else\n            ui.notifications.warn(`Could not find ${talent}`, {permanent : true})\n    }\n\n}\nawait this.actor.update(updateObj)\nthis.actor.createEmbeddedDocuments(\"Item\", items);\n\nfunction equip(item)\n{\n    if (item.type == \"armour\")\n        item.data.worn.value = true\n    else if (item.type == \"weapon\")\n        item.data.equipped = true\n    else if (item.type == \"trapping\" && item.data.trappingType.value == \"clothingAccessories\")\n        item.data.worn = true\n}"}},"tint":null,"origin":null}],"flags":{"wfrp4e-owb1":{"initialization-folder":"Templates","sort":600000},"core":{"sourceId":"Compendium.wfrp4e-owb1.items.TP91Bx8K4PUbNKFH"}},"system":{"description":{"type":"String","label":"Description","value":"<p>Soldiers are the mainstay of most warbands. The generic creature from the Bestiary can represent soldiers in many cases, but many are more experienced fighters.</p>"},"gmdescription":{"type":"String","label":"Description","value":""},"rollable":{"value":false,"damage":false,"skill":"","label":"Rollable","type":"Boolean","rollCharacteristic":"","bonusCharacteristic":"","dice":"","defaultDifficulty":"challenging","SL":true,"attackType":"melee"},"specification":{"value":"","type":"String","label":"Specification"},"qualities":{"label":"Qualities","value":[]},"flaws":{"label":"Flaws","value":[]}},"_stats":{"systemId":"wfrp4e","systemVersion":"6.5.9","coreVersion":"10.303","createdTime":1688304223283,"modifiedTime":1688304223283,"lastModifiedBy":"QnM952ZqoCxWL1Ok"},"_id":"TP91Bx8K4PUbNKFH","folder":null,"sort":0,"ownership":{"default":0,"QnM952ZqoCxWL1Ok":3}}
{"name":"Veteran of Adventures","type":"trait","img":"systems/wfrp4e/icons/blank.png","effects":[{"_id":"GPWvWnhtvfc1jdvJ","changes":[],"disabled":false,"duration":{"startTime":null,"seconds":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"icon":"systems/wfrp4e/icons/blank.png","label":"Veteran of Adventures","transfer":true,"flags":{"wfrp4e":{"effectTrigger":"oneTime","effectApplication":"actor","hide":false,"preventDuplicateEffects":false,"script":"let characteristics = {\n            \"ws\" : 5,\n            \"bs\" : 0,\n            \"s\" : 5,\n            \"t\" : 5,\n            \"i\" : 10,\n            \"ag\" : 0,\n            \"dex\" : 0,\n            \"int\" : 0,\n            \"wp\" : 0,\n            \"fel\" : 0\n        }\n        let skills = [\"Cool\", \"Dodge\"]\n        let skillAdvancements = [10, 10]\n        let talents = [\"Combat Reflexes\"]\n        let trappings = [\"Leather Jack\", \"Leather Skullcap\", \"Leather Leggings\", \"Shield\"]\n        let items = []\n\n        let updateObj = this.actor.toObject();\n        \n        for (let ch in characteristics)\n        {\n            updateObj.system.characteristics[ch].modifier += characteristics[ch];\n        }\n        \n        for (let index = 0; index < skills.length; index++)\n        {\n            let skill = skills[index]\n            let skillItem;\n            skillItem = updateObj.items.find(i => i.name == skill && i.type == \"skill\")\n            if (skillItem)\n                skillItem.system.advances.value += skillAdvancements[index]\n            else \n            {\n                skillItem = await game.wfrp4e.utility.findSkill(skill)\n                skillItem = skillItem.toObject();\n                skillItem.system.advances.value = skillAdvancements[index];\n                items.push(skillItem);\n            }\n        }\n        \n        for (let talent of talents)\n        {\n            let talentItem = await game.wfrp4e.utility.findTalent(talent)\n            if (talentItem)\n            {\n                items.push(talentItem.toObject());\n            }\n            else \n            {\n                ui.notifications.warn(`Could not find ${talent}`, {permanent : true})\n            }\n        }\n        \n        for (let trapping of trappings) \n        {\n            let trappingItem = await game.wfrp4e.utility.findItem(trapping)\n            if (trappingItem)\n            {\n                trappingItem = trappingItem.toObject()\n        \n                equip(trappingItem)\n        \n                items.push(trappingItem);\n            }\n            else \n            {\n                ui.notifications.warn(`Could not find ${trapping}`, {permanent : true})\n            }\n        }\n      \n        \n        await this.actor.update(updateObj)\n        this.actor.createEmbeddedDocuments(\"Item\", items);\n        \n        function equip(item)\n        {\n            if (item.type == \"armour\")\n                item.system.worn.value = true\n            else if (item.type == \"weapon\")\n                item.system.equipped = true\n            else if (item.type == \"trapping\" && item.system.trappingType.value == \"clothingAccessories\")\n                item.system.worn = true\n        }"}},"tint":null,"origin":null},{"_id":"y5lZLHlRcXljQtk3","changes":[],"disabled":false,"duration":{"startTime":null,"seconds":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"icon":"systems/wfrp4e/icons/blank.png","label":"Skill Choice","transfer":true,"flags":{"wfrp4e":{"effectTrigger":"oneTime","effectApplication":"actor","hide":false,"preventDuplicateEffects":false,"script":"        let choices = await Promise.all([game.wfrp4e.utility.findItemId(\"PzimjNx9Ojq4g6mV\"), game.wfrp4e.utility.findItemId(\"rOPmyLWa37e7s9v6\")])\n        let items = await game.wfrp4e.apps.ItemDialog.create(choices, 1, \"Choose a Skill\")\n\n        items = items.map(i => i.toObject())\n        items.forEach(i => i.system.advances.value = 20)\n\nitems.forEach(i => equip(i))\n\nthis.actor.createEmbeddedDocuments(\"Item\", items);\n\nfunction equip(item)\n{\n    if (item.type == \"armour\")\n        item.data.worn.value = true\n    else if (item.type == \"weapon\")\n        item.data.equipped = true\n    else if (item.type == \"trapping\" && item.data.trappingType.value == \"clothingAccessories\")\n        item.data.worn = true\n}"}},"tint":null,"origin":null},{"_id":"65mmlSrpaGzLowYh","changes":[],"disabled":false,"duration":{"startTime":null,"seconds":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"icon":"systems/wfrp4e/icons/blank.png","label":"Weapon Choice","transfer":true,"flags":{"wfrp4e":{"effectTrigger":"oneTime","effectApplication":"actor","hide":false,"preventDuplicateEffects":false,"script":"        let choices = await Promise.all([game.wfrp4e.utility.findItemId(\"1zaqojk0Oq1m8vYv\"), game.wfrp4e.utility.findItemId(\"zIuarD5mB0EF0ji0\")])\n        let items = await game.wfrp4e.apps.ItemDialog.create(choices, 1, \"Choose a Weapon\")\n        items = items.map(i => i.toObject())\n        \n        items.forEach(i => equip(i))\n        \n        this.actor.createEmbeddedDocuments(\"Item\", items);\n        \n        function equip(item)\n        {\n            if (item.type == \"armour\")\n                item.data.worn.value = true\n            else if (item.type == \"weapon\")\n                item.data.equipped = true\n            else if (item.type == \"trapping\" && item.data.trappingType.value == \"clothingAccessories\")\n                item.data.worn = true\n        }"}},"tint":null,"origin":null}],"flags":{"core":{"sourceId":"Item.kAMXgJUDGOAKJ01T"},"wfrp4e-owb1":{"initialization-folder":"Templates","sort":100000},"wfrp4e-up-in-arms":{"initialization-folder":"Templates","sort":375000}},"system":{"description":{"type":"String","label":"Description","value":""},"gmdescription":{"type":"String","label":"Description","value":""},"rollable":{"value":false,"damage":false,"skill":"","label":"Rollable","type":"Boolean","rollCharacteristic":"","bonusCharacteristic":"","dice":"","defaultDifficulty":"challenging","SL":true,"attackType":"melee"},"specification":{"value":"","type":"String","label":"Specification"},"qualities":{"label":"Qualities","value":[]},"flaws":{"label":"Flaws","value":[]}},"_stats":{"systemId":"wfrp4e","systemVersion":"6.5.9","coreVersion":"10.303","createdTime":1670793141344,"modifiedTime":1688303733486,"lastModifiedBy":"QnM952ZqoCxWL1Ok"},"_id":"Xp4r2KUhqfjak8zq","folder":null,"sort":0,"ownership":{"default":0,"QnM952ZqoCxWL1Ok":3}}
{"name":"Bright Spark","type":"trait","img":"systems/wfrp4e/icons/blank.png","effects":[{"_id":"GPWvWnhtvfc1jdvJ","changes":[],"disabled":false,"duration":{"startTime":null,"seconds":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"icon":"systems/wfrp4e/icons/blank.png","label":"Bright Spark","transfer":true,"flags":{"wfrp4e":{"effectTrigger":"oneTime","effectApplication":"actor","hide":false,"preventDuplicateEffects":false,"script":"   let characteristics = {\n            \"ws\" : 0,\n            \"bs\" : 0,\n            \"s\" : 0,\n            \"t\" : 0,\n            \"i\" : 10,\n            \"ag\" : 0,\n            \"dex\" : 0,\n            \"int\" : 10,\n            \"wp\" : 5,\n            \"fel\" : 5\n        }\n        let skills = [\"Intuition\", \"Lore (Local)\", \"Perception\"]\n        let skillAdvancements = [10, 10, 10]\n        let talents = []\n        let trappings = [\"Mail Coat\", \"Mail Chausses\", \"Mail Coif\", \"Hand Weapon\"]\n        let items = []\n\n        let updateObj = this.actor.toObject();\n        \n        for (let ch in characteristics)\n        {\n            updateObj.system.characteristics[ch].modifier += characteristics[ch];\n        }\n        \n        for (let index = 0; index < skills.length; index++)\n        {\n            let skill = skills[index]\n            let skillItem;\n            skillItem = updateObj.items.find(i => i.name == skill && i.type == \"skill\")\n            if (skillItem)\n                skillItem.system.advances.value += skillAdvancements[index]\n            else \n            {\n                skillItem = await game.wfrp4e.utility.findSkill(skill)\n                skillItem = skillItem.toObject();\n                skillItem.system.advances.value = skillAdvancements[index];\n                items.push(skillItem);\n            }\n        }\n        \n        for (let talent of talents)\n        {\n            let talentItem = await game.wfrp4e.utility.findTalent(talent)\n            if (talentItem)\n            {\n                items.push(talentItem.toObject());\n            }\n            else \n            {\n                ui.notifications.warn(`Could not find ${talent}`, {permanent : true})\n            }\n        }\n        \n        for (let trapping of trappings) \n        {\n            let trappingItem = await game.wfrp4e.utility.findItem(trapping)\n            if (trappingItem)\n            {\n                trappingItem = trappingItem.toObject()\n        \n                equip(trappingItem)\n        \n                items.push(trappingItem);\n            }\n            else \n            {\n                ui.notifications.warn(`Could not find ${trapping}`, {permanent : true})\n            }\n        }\n        \n        \n        await this.actor.update(updateObj)\n        this.actor.createEmbeddedDocuments(\"Item\", items);\n        \n        function equip(item)\n        {\n            if (item.type == \"armour\")\n                item.system.worn.value = true\n            else if (item.type == \"weapon\")\n                item.system.equipped = true\n            else if (item.type == \"trapping\" && item.system.trappingType.value == \"clothingAccessories\")\n                item.system.worn = true\n        }"}},"tint":null,"origin":null}],"flags":{"core":{"sourceId":"Item.kAMXgJUDGOAKJ01T"},"wfrp4e-owb1":{"initialization-folder":"Templates","sort":100000},"wfrp4e-up-in-arms":{"initialization-folder":"Templates","sort":100000}},"system":{"description":{"type":"String","label":"Description","value":""},"gmdescription":{"type":"String","label":"Description","value":""},"rollable":{"value":false,"damage":false,"skill":"","label":"Rollable","type":"Boolean","rollCharacteristic":"","bonusCharacteristic":"","dice":"","defaultDifficulty":"challenging","SL":true,"attackType":"melee"},"specification":{"value":"","type":"String","label":"Specification"},"qualities":{"label":"Qualities","value":[]},"flaws":{"label":"Flaws","value":[]}},"_stats":{"systemId":"wfrp4e","systemVersion":"6.5.9","coreVersion":"10.303","createdTime":1670793141344,"modifiedTime":1688303756416,"lastModifiedBy":"QnM952ZqoCxWL1Ok"},"_id":"ac5ClOuaYtzOYyWp","folder":null,"sort":0,"ownership":{"default":0,"QnM952ZqoCxWL1Ok":3}}
{"name":"Hireling","type":"trait","img":"systems/wfrp4e/icons/blank.png","system":{"description":{"type":"String","label":"Description","value":""},"gmdescription":{"type":"String","label":"Description","value":""},"rollable":{"value":false,"damage":false,"skill":"","label":"Rollable","type":"Boolean","rollCharacteristic":"","bonusCharacteristic":"","dice":"","defaultDifficulty":"challenging","SL":true,"attackType":"melee"},"specification":{"value":"","type":"String","label":"Specification"},"qualities":{"label":"Qualities","value":[]},"flaws":{"label":"Flaws","value":[]}},"effects":[{"label":"Hireling","icon":"systems/wfrp4e/icons/blank.png","transfer":true,"_id":"GB6h9KotqpcouOmE","changes":[],"disabled":false,"duration":{"startTime":null,"seconds":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"origin":null,"tint":null,"flags":{"wfrp4e":{"effectTrigger":"oneTime","effectApplication":"actor","hide":false,"preventDuplicateEffects":false,"script":"        const templateMap = {\n            'P2e7Yx98bK3u110a' : \"\",\n            'iuMp3KLaMT2WCmie' : \"Xp4r2KUhqfjak8zq\", \n            'RBuYcT5tppwcmnC5' : \"wYN19h3WVF1yOVq2\", \n            'vcGpNwNbhvfzVveQ' : \"ac5ClOuaYtzOYyWp\", \n            'jmhKZy0w9TzkEK9c' : \"IS3LTdTuay6uRHUq\", \n            '9Byj6k7SmdTYis2V' : \"LjMlx99gBGeRJUQu\", \n            'laJwc2l9tzJPgaaJ' : \"x5wpMprsObuqMCYg\",\n        }\n        let template = (await game.wfrp4e.tables.rollTable(\"hireling-templates\")).object;\n        let physicalQuirk = (await game.wfrp4e.tables.rollTable(\"physical-quirks\")).text;\n        let workEthic = (await game.wfrp4e.tables.rollTable(\"work-ethic\")).text;\n        let personalityQuirk = (await game.wfrp4e.tables.rollTable(\"personality-quirks\")).text;\n\n\n        let templateItem = await game.wfrp4e.utility.findItemId(templateMap[template._id]);\n\n        let bio = \n        `\n        <p><strong>Template</strong>: ${template.text}</p>\n        <p><strong>Phsyical Quirk</strong>: ${physicalQuirk}</p>\n        <p><strong>Work Ethic</strong>: ${workEthic}</p>\n        <p><strong>Personality Quirk</strong>: ${personalityQuirk}</p>\n        `\n\n        await this.actor.update({\"system.details.gmnotes.value\" : bio})\n\n        if (templateItem)\n        {\n            this.actor.createEmbeddedDocuments(\"Item\", [templateItem.toObject()])\n        }"}}}],"flags":{"wfrp4e-up-in-arms":{"initialization-folder":"Templates","sort":300000},"core":{"sourceId":"Compendium.wfrp4e-up-in-arms.items.gjtcCTmRPxTL4oAL"}},"_stats":{"systemId":"wfrp4e","systemVersion":"6.5.9","coreVersion":"10.303","createdTime":1670801220215,"modifiedTime":1688303487367,"lastModifiedBy":"QnM952ZqoCxWL1Ok"},"_id":"gjtcCTmRPxTL4oAL","folder":null,"sort":0,"ownership":{"default":0,"QnM952ZqoCxWL1Ok":3}}
{"name":"Elite","type":"trait","img":"systems/wfrp4e/icons/blank.png","effects":[{"_id":"GPWvWnhtvfc1jdvJ","changes":[],"disabled":false,"duration":{"startTime":null,"seconds":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"icon":"systems/wfrp4e/icons/blank.png","label":"Elite","transfer":true,"flags":{"wfrp4e":{"effectTrigger":"oneTime","effectApplication":"actor","hide":false,"preventDuplicateEffects":false,"script":"let characteristics = {\n    \"ws\" : 10,\n    \"bs\" : 0,\n    \"s\" : 10,\n    \"t\" : 10,\n    \"i\" : 20,\n    \"ag\" : 10,\n    \"dex\" : 0,\n    \"int\" : 0,\n    \"wp\" : 15,\n    \"fel\" : 0\n}\nlet skills = [\"Cool\", \"Dodge\", \"Intimidate\", \"Leadership\"]\nlet skillAdvancements = [15, 15, 10, 5]\nlet talents = [\"Combat Aware\", \"Combat Reflexes\", \"Feint\", \"Resolute\"]\nlet trappings = [\"Mail Coat\", \"Mail Chausses\", \"Mail Coif\", \"Hand Weapon\", \"Shield\"]\nlet items = [];\n\nlet updateObj = this.actor.toObject();\n\nfor (let ch in characteristics)\n{\n    updateObj.data.characteristics[ch].modifier += characteristics[ch];\n}\n\nfor (let index = 0; index < skills.length; index++)\n{\n    let skill = skills[index]\n    let skillItem;\n    skillItem = updateObj.items.find(i => i.name == skill && i.type == \"skill\")\n    if (skillItem)\n        skillItem.data.advances.value += skillAdvancements[index]\n    else \n    {\n        skillItem = await game.wfrp4e.utility.findSkill(skill)\n        skillItem = skillItem.toObject();\n        skillItem.data.advances.value = skillAdvancements[index];\n        items.push(skillItem);\n    }\n}\n\nfor (let talent of talents)\n{\n    let talentItem = await game.wfrp4e.utility.findTalent(talent)\n    if (talentItem)\n    {\n        items.push(talentItem.toObject());\n    }\n    else \n    {\n        ui.notifications.warn(`Could not find ${talent}`, {permanent : true})\n    }\n}\n\nfor (let trapping of trappings) \n{\n    let trappingItem = await game.wfrp4e.utility.findItem(trapping)\n    if (trappingItem)\n    {\n        trappingItem = trappingItem.toObject()\n\n        equip(trappingItem)\n\n        items.push(trappingItem);\n    }\n    else \n    {\n        ui.notifications.warn(`Could not find ${trapping}`, {permanent : true})\n    }\n}\n\nupdateObj.name = this.effect.label + \" \" + updateObj.name\n\nawait this.actor.update(updateObj)\nthis.actor.createEmbeddedDocuments(\"Item\", items);\n\nfunction equip(item)\n{\n    if (item.type == \"armour\")\n        item.data.worn.value = true\n    else if (item.type == \"weapon\")\n        item.data.equipped = true\n    else if (item.type == \"trapping\" && item.data.trappingType.value == \"clothingAccessories\")\n        item.data.worn = true\n}"}},"tint":null,"origin":null},{"_id":"AuJTlxoXcNzVmzBD","changes":[],"disabled":false,"duration":{"startTime":null,"seconds":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"icon":"systems/wfrp4e/icons/blank.png","label":"Skill Choice","transfer":true,"flags":{"wfrp4e":{"effectTrigger":"oneTime","effectApplication":"actor","hide":false,"preventDuplicateEffects":false,"script":"let choice1 = [\n    {\n        type : \"skill\",\n        name : \"Melee (Basic)\",\n        diff : {\n            data : {\n                advances : {\n                    value : 20\n                }\n            }\n        }\n    }\n]\nlet choice2 = [\n    {\n        type : \"skill\",\n        name : \"Melee (Polearm)\",\n        diff : {\n            data : {\n                advances : {\n                    value : 20\n                }\n            }\n        }\n    }\n]\n\nlet choice3 = [\n    {\n        type : \"skill\",\n        name : \"Melee (Two-Handed)\",\n        diff : {\n            data : {\n                advances : {\n                    value : 20\n                }\n            }\n        }\n    }\n]\n\nlet choice = await new Promise((resolve, reject) => {\n    new Dialog({\n        title : \"Choice\",\n        content : \n        `<p>\n        Select your choice\n        </p>\n        <ol>\n        <li>Melee (Basic)</li>\n        <li>Melee (Polearm)</li>\n        <li>Melee (Two-Handed)</li>\n        </ol> \n        `,\n        buttons : {\n            1 : {\n                label : \"Basic\",\n                callback : () => {\n                    resolve(choice1)\n                }\n            },\n            2 : {\n                label : \"Polearm\",\n                callback : () => {\n                    resolve(choice2)\n                }\n            },\n            3 : {\n                label : \"Two-Handed\",\n                callback : () => {\n                    resolve(choice3)\n                }\n            }\n        }\n    }).render(true)\n}) \n\nlet updateObj = this.actor.toObject();\nlet items = []\nfor (let c of choice)\n{\n    let existing \n    if (c.type == \"skill\")\n    {\n        existing = updateObj.items.find(i => i.name == c.name && i.type == c.type)\n        if (existing && c.diff?.data?.advances?.value)\n        {\n            existing.data.advances.value += c.diff.data.advances.value\n        }\n    }\n\n    if (!existing)\n    {\n        let item = await game.wfrp4e.utility.find(c.name, c.type)\n        if (item)\n        {\n            item = item.toObject()\n            equip(item);\n                items.push(mergeObject(item, (c.diff || {})))\n        }\n        else\n            ui.notifications.warn(`Could not find ${talent}`, {permanent : true})\n    }\n\n}\nawait this.actor.update(updateObj)\nthis.actor.createEmbeddedDocuments(\"Item\", items);\n\nfunction equip(item)\n{\n    if (item.type == \"armour\")\n        item.data.worn.value = true\n    else if (item.type == \"weapon\")\n        item.data.equipped = true\n    else if (item.type == \"trapping\" && item.data.trappingType.value == \"clothingAccessories\")\n        item.data.worn = true\n}"}},"tint":null,"origin":null},{"_id":"hqQqm22V9XgBjF4G","changes":[],"disabled":false,"duration":{"startTime":null,"seconds":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"icon":"systems/wfrp4e/icons/blank.png","label":"Weapon Choice","transfer":true,"flags":{"wfrp4e":{"effectTrigger":"oneTime","effectApplication":"actor","hide":false,"preventDuplicateEffects":false,"script":"let filters = [\n    {\n        property : \"type\",\n        value : \"weapon\"\n    },\n    {\n        property : \"data.weaponGroup.value\",\n        value : [\"twohanded\", \"polearm\"]\n    }\n]\n\nlet items = await game.wfrp4e.apps.ItemDialog.createFromFilters(filters, 1, \"Choose an appropriate Polearm or Two-Handed Weapon\")\nitems = items.map(i => i.toObject())\n\nitems.forEach(i => equip(i))\n\nthis.actor.createEmbeddedDocuments(\"Item\", items);\n\nfunction equip(item)\n{\n    if (item.type == \"armour\")\n        item.data.worn.value = true\n    else if (item.type == \"weapon\")\n        item.data.equipped = true\n    else if (item.type == \"trapping\" && item.data.trappingType.value == \"clothingAccessories\")\n        item.data.worn = true\n}"}},"tint":null,"origin":null}],"flags":{"wfrp4e-owb1":{"initialization-folder":"Templates","sort":200000},"core":{"sourceId":"Compendium.wfrp4e-owb1.items.kAMXgJUDGOAKJ01T"}},"system":{"description":{"type":"String","label":"Description","value":"<p>Warbands often include small coteries of elite warriors who guard important individuals or lead less-experienced warriors (Skaven Stormvermin and Beastman Bestigors usually fulfil this role in their respective warbands).</p>"},"gmdescription":{"type":"String","label":"Description","value":""},"rollable":{"value":false,"damage":false,"skill":"","label":"Rollable","type":"Boolean","rollCharacteristic":"","bonusCharacteristic":"","dice":"","defaultDifficulty":"challenging","SL":true,"attackType":"melee"},"specification":{"value":"","type":"String","label":"Specification"},"qualities":{"label":"Qualities","value":[]},"flaws":{"label":"Flaws","value":[]}},"_stats":{"systemId":"wfrp4e","systemVersion":"6.5.9","coreVersion":"10.303","createdTime":1688304219409,"modifiedTime":1688304219409,"lastModifiedBy":"QnM952ZqoCxWL1Ok"},"_id":"kAMXgJUDGOAKJ01T","folder":null,"sort":0,"ownership":{"default":0,"QnM952ZqoCxWL1Ok":3}}
{"name":"Shaman Lord","type":"trait","img":"systems/wfrp4e/icons/blank.png","effects":[{"_id":"vtHQSj1XPWKSu7U2","changes":[],"disabled":false,"duration":{"startTime":null,"seconds":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"icon":"systems/wfrp4e/icons/blank.png","label":"Shaman Lord","transfer":true,"flags":{"wfrp4e":{"effectTrigger":"oneTime","effectApplication":"actor","hide":false,"preventDuplicateEffects":false,"script":"let characteristics = {\n    \"ws\" : 10,\n    \"bs\" : 0,\n    \"s\" : 5,\n    \"t\" : 15,\n    \"i\" : 20,\n    \"ag\" : 15,\n    \"dex\" : 20,\n    \"int\" : 35,\n    \"wp\" : 30,\n    \"fel\" : 10\n}\nlet skills = [\"Channelling\", \"Cool\", \"Dodge\", \"Entertain (Storytelling)\", \"Intuition\", \"Language (Magick)\", \"Leadership\", \"Lore (Magic)\", \"Lore (Theology)\", \"Perception\"]\nlet skillAdvancements = [20, 25, 20, 25, 30, 25, 15, 20, 10, 30]\nlet talents = [\"Aethyric Attunement\", \"Arcane Magic\", \"Instinctive Diction\", \"Instinctive Diction\", \"Luck\", \"Magical Sense\", \"Menacing\", \"Petty Magic\", \"Second Sight\", \"Sixth Sense\"]\nlet trappings = [\"Hand Weapon\", \"Quarterstaff\", \"Ritual Dress incorporating many ingredients and fetishes\"]\nlet items = [];\n\nlet updateObj = this.actor.toObject();\n\nfor (let ch in characteristics)\n{\n    updateObj.data.characteristics[ch].modifier += characteristics[ch];\n}\n\nfor (let index = 0; index < skills.length; index++)\n{\n    let skill = skills[index]\n    let skillItem;\n    skillItem = updateObj.items.find(i => i.name == skill && i.type == \"skill\")\n    if (skillItem)\n        skillItem.data.advances.value += skillAdvancements[index]\n    else \n    {\n        skillItem = await game.wfrp4e.utility.findSkill(skill)\n        skillItem = skillItem.toObject();\n        skillItem.data.advances.value = skillAdvancements[index];\n        items.push(skillItem);\n    }\n}\n\nfor (let talent of talents)\n{\n    let talentItem = await game.wfrp4e.utility.findTalent(talent)\n    if (talentItem)\n    {\n        items.push(talentItem.toObject());\n    }\n    else \n    {\n        ui.notifications.warn(`Could not find ${talent}`, {permanent : true})\n    }\n}\n\nfor (let trapping of trappings) \n{\n    let trappingItem = await game.wfrp4e.utility.findItem(trapping)\n    if (trappingItem)\n    {\n        trappingItem = trappingItem.toObject()\n\n        equip(trappingItem)\n\n        items.push(trappingItem);\n    }\n    else \n    {\n        items.push({name : trapping, type : \"trapping\", \"data.trappingType.value\" : \"clothingAccessories\"})\n        //ui.notifications.warn(`Could not find ${trapping}`, {permanent : true})\n    }\n}\n\nupdateObj.name = updateObj.name += \" \" + this.effect.label\n\nawait this.actor.update(updateObj)\nthis.actor.createEmbeddedDocuments(\"Item\", items);\n\nfunction equip(item)\n{\n    if (item.type == \"armour\")\n        item.data.worn.value = true\n    else if (item.type == \"weapon\")\n        item.data.equipped = true\n    else if (item.type == \"trapping\" && item.data.trappingType.value == \"clothingAccessories\")\n        item.data.worn = true\n}"}},"tint":null,"origin":null},{"_id":"qAvOQQOsNHVDhUZZ","changes":[],"disabled":false,"duration":{"startTime":null,"seconds":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"icon":"systems/wfrp4e/icons/blank.png","label":"Skill Choice","transfer":true,"flags":{"wfrp4e":{"effectTrigger":"oneTime","effectApplication":"actor","hide":false,"preventDuplicateEffects":false,"script":"let choice1 = [\n    {\n        type : \"skill\",\n        name : \"Melee (Basic)\",\n        diff : {\n            data : {\n                advances : {\n                    value : 10\n                }\n            }\n        }\n    }\n]\nlet choice2 = [\n    {\n        type : \"skill\",\n        name : \"Melee (Polearm)\",\n        diff : {\n            data : {\n                advances : {\n                    value : 10\n                }\n            }\n        }\n    }\n]\n\nlet choice = await new Promise((resolve, reject) => {\n    new Dialog({\n        title : \"Choice\",\n        content : \n        `<p>\n        Select your choice\n        </p>\n        <ol>\n        <li>Melee (Basic)</li>\n        <li>Melee (Polearm)</li>\n        </ol> \n        `,\n        buttons : {\n            1 : {\n                label : \"Basic\",\n                callback : () => {\n                    resolve(choice1)\n                }\n            },\n            2 : {\n                label : \"Polearm\",\n                callback : () => {\n                    resolve(choice2)\n                }\n            }\n        }\n    }).render(true)\n}) \n\nlet updateObj = this.actor.toObject();\nlet items = []\nfor (let c of choice)\n{\n    let existing \n    if (c.type == \"skill\")\n    {\n        existing = updateObj.items.find(i => i.name == c.name && i.type == c.type)\n        if (existing && c.diff?.data?.advances?.value)\n        {\n            existing.data.advances.value += c.diff.data.advances.value\n        }\n    }\n\n    if (!existing)\n    {\n        let item = await game.wfrp4e.utility.find(c.name, c.type)\n        if (item)\n        {\n            item = item.toObject()\n            equip(item);\n                items.push(mergeObject(item, (c.diff || {})))\n        }\n        else\n            ui.notifications.warn(`Could not find ${talent}`, {permanent : true})\n    }\n\n}\nawait this.actor.update(updateObj)\nthis.actor.createEmbeddedDocuments(\"Item\", items);\n\nfunction equip(item)\n{\n    if (item.type == \"armour\")\n        item.data.worn.value = true\n    else if (item.type == \"weapon\")\n        item.data.equipped = true\n    else if (item.type == \"trapping\" && item.data.trappingType.value == \"clothingAccessories\")\n        item.data.worn = true\n}"}},"tint":null,"origin":null},{"_id":"DpmuzzUifhWbCae2","changes":[],"disabled":false,"duration":{"startTime":null,"seconds":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"icon":"systems/wfrp4e/icons/blank.png","label":"Spell Choice","transfer":true,"flags":{"wfrp4e":{"effectTrigger":"oneTime","effectApplication":"actor","hide":false,"preventDuplicateEffects":false,"script":"let filters = [\n    {\n        property : \"type\",\n        value : \"spell\"\n    },\n    {\n        property : \"data.lore.value\",\n        value : \"petty\"\n    }\n]\n\nlet petty = await game.wfrp4e.apps.ItemDialog.createFromFilters(filters, 6, \"Choose 6 Petty Spells\")\n\n\nfilters = [\n    {\n        property : \"type\",\n        value : \"spell\"\n    },\n    {\n        property : \"data.lore.value\",\n        value : \"\"\n    }\n]\n\nlet arcane = await game.wfrp4e.apps.ItemDialog.createFromFilters(filters, 9, \"Choose 9 Arcane Spells\")\n\nlet items = petty.concat(arcane).map(i => i.toObject())\n\nthis.actor.createEmbeddedDocuments(\"Item\", items);"}},"tint":null,"origin":null}],"flags":{"wfrp4e-owb1":{"initialization-folder":"Templates","sort":400000},"core":{"sourceId":"Compendium.wfrp4e-owb1.items.lgpQQsMBOr2gFhYp"}},"system":{"description":{"type":"String","label":"Description","value":"<p>Petty magicians and mystics, a Shaman acts as the spiritual advisor of the warband, guiding their Chiefs and assisting in warfare with their crude but powerful spells.</p>"},"gmdescription":{"type":"String","label":"Description","value":""},"rollable":{"value":false,"damage":false,"skill":"","label":"Rollable","type":"Boolean","rollCharacteristic":"","bonusCharacteristic":"","dice":"","defaultDifficulty":"challenging","SL":true,"attackType":"melee"},"specification":{"value":"","type":"String","label":"Specification"},"qualities":{"label":"Qualities","value":[]},"flaws":{"label":"Flaws","value":[]}},"_stats":{"systemId":"wfrp4e","systemVersion":"6.5.9","coreVersion":"10.303","createdTime":1688304221468,"modifiedTime":1688304221468,"lastModifiedBy":"QnM952ZqoCxWL1Ok"},"_id":"lgpQQsMBOr2gFhYp","folder":null,"sort":0,"ownership":{"default":0,"QnM952ZqoCxWL1Ok":3}}
{"name":"Infirm","type":"trait","img":"systems/wfrp4e/icons/blank.png","effects":[{"_id":"GPWvWnhtvfc1jdvJ","changes":[],"disabled":false,"duration":{"startTime":null,"seconds":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"icon":"systems/wfrp4e/icons/blank.png","label":"Infirm","transfer":true,"flags":{"wfrp4e":{"effectTrigger":"oneTime","effectApplication":"actor","hide":false,"preventDuplicateEffects":false,"script":"   let characteristics = {\n            \"ws\" : -10,\n            \"bs\" : -10,\n            \"s\" : -5,\n            \"t\" : -5,\n            \"i\" : -10,\n            \"ag\" : -10,\n            \"dex\" : -10,\n            \"int\" : 0,\n            \"wp\" : 0,\n            \"fel\" : 0\n        }\n        let skills = []\n        let skillAdvancements = []\n        let talents = []\n        let trappings = []\n        let items = []\n\n        let updateObj = this.actor.toObject();\n        \n        for (let ch in characteristics)\n        {\n            updateObj.system.characteristics[ch].modifier += characteristics[ch];\n        }\n        \n        for (let index = 0; index < skills.length; index++)\n        {\n            let skill = skills[index]\n            let skillItem;\n            skillItem = updateObj.items.find(i => i.name == skill && i.type == \"skill\")\n            if (skillItem)\n                skillItem.system.advances.value += skillAdvancements[index]\n            else \n            {\n                skillItem = await game.wfrp4e.utility.findSkill(skill)\n                skillItem = skillItem.toObject();\n                skillItem.system.advances.value = skillAdvancements[index];\n                items.push(skillItem);\n            }\n        }\n        \n        for (let talent of talents)\n        {\n            let talentItem = await game.wfrp4e.utility.findTalent(talent)\n            if (talentItem)\n            {\n                items.push(talentItem.toObject());\n            }\n            else \n            {\n                ui.notifications.warn(`Could not find ${talent}`, {permanent : true})\n            }\n        }\n        \n        for (let trapping of trappings) \n        {\n            let trappingItem = await game.wfrp4e.utility.findItem(trapping)\n            if (trappingItem)\n            {\n                trappingItem = trappingItem.toObject()\n        \n                equip(trappingItem)\n        \n                items.push(trappingItem);\n            }\n            else \n            {\n                ui.notifications.warn(`Could not find ${trapping}`, {permanent : true})\n            }\n        }\n       \n        \n        await this.actor.update(updateObj)\n        this.actor.createEmbeddedDocuments(\"Item\", items);\n        \n        function equip(item)\n        {\n            if (item.type == \"armour\")\n                item.system.worn.value = true\n            else if (item.type == \"weapon\")\n                item.system.equipped = true\n            else if (item.type == \"trapping\" && item.system.trappingType.value == \"clothingAccessories\")\n                item.system.worn = true\n        }"}},"tint":null,"origin":null},{"label":"Infirm","icon":"systems/wfrp4e/icons/blank.png","transfer":true,"_id":"qJ7XcDKvHFyGkvMO","changes":[{"key":"system.details.move.value","mode":2,"value":"-1","priority":null}],"disabled":false,"duration":{"startTime":null,"seconds":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"origin":null,"tint":null,"flags":{"wfrp4e":{"effectTrigger":"prePrepareItem","effectApplication":"actor","hide":false,"preventDuplicateEffects":false,"script":"if (args.item.type == \"skill\") args.item.system.modifier.value -= 10"}}}],"flags":{"core":{"sourceId":"Item.kAMXgJUDGOAKJ01T"},"wfrp4e-owb1":{"initialization-folder":"Templates","sort":100000},"wfrp4e-up-in-arms":{"initialization-folder":"Templates","sort":400000}},"system":{"description":{"type":"String","label":"Description","value":""},"gmdescription":{"type":"String","label":"Description","value":""},"rollable":{"value":false,"damage":false,"skill":"","label":"Rollable","type":"Boolean","rollCharacteristic":"","bonusCharacteristic":"","dice":"","defaultDifficulty":"challenging","SL":true,"attackType":"melee"},"specification":{"value":"","type":"String","label":"Specification"},"qualities":{"label":"Qualities","value":[]},"flaws":{"label":"Flaws","value":[]}},"_stats":{"systemId":"wfrp4e","systemVersion":"6.5.9","coreVersion":"10.303","createdTime":1670793141344,"modifiedTime":1688303513585,"lastModifiedBy":"QnM952ZqoCxWL1Ok"},"_id":"wYN19h3WVF1yOVq2","folder":null,"sort":0,"ownership":{"default":0,"QnM952ZqoCxWL1Ok":3}}
{"name":"Diamond in the Rough","type":"trait","img":"systems/wfrp4e/icons/blank.png","effects":[{"_id":"GPWvWnhtvfc1jdvJ","changes":[],"disabled":false,"duration":{"startTime":null,"seconds":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"icon":"systems/wfrp4e/icons/blank.png","label":"Diamond in the Rough","transfer":true,"flags":{"wfrp4e":{"effectTrigger":"oneTime","effectApplication":"actor","hide":false,"preventDuplicateEffects":false,"script":"        let characteristics = {\n            \"ws\" : 5,\n            \"bs\" : 5,\n            \"s\" : 5,\n            \"t\" : 0,\n            \"i\" : 5,\n            \"ag\" : 5,\n            \"dex\" : 5,\n            \"int\" : 0,\n            \"wp\" : 5,\n            \"fel\" : 5\n        }\n        let items = []\n\n        let updateObj = this.actor.toObject();\n\n        let talents = (await Promise.all([game.wfrp4e.tables.rollTable(\"talents\"), game.wfrp4e.tables.rollTable(\"talents\"), game.wfrp4e.tables.rollTable(\"talents\")])).map(i => i.text)\n        \n        for (let ch in characteristics)\n        {\n            updateObj.system.characteristics[ch].modifier += characteristics[ch];\n        }\n        \n        for (let talent of talents)\n        {\n            let talentItem = await game.wfrp4e.utility.findTalent(talent)\n            if (talentItem)\n            {\n                items.push(talentItem.toObject());\n            }\n            else \n            {\n                ui.notifications.warn(`Could not find ${talent}`, {permanent : true})\n            }\n        }\n      \n        \n        await this.actor.update(updateObj)\n        this.actor.createEmbeddedDocuments(\"Item\", items);\n    \n"}},"tint":null,"origin":null}],"flags":{"core":{"sourceId":"Item.kAMXgJUDGOAKJ01T"},"wfrp4e-owb1":{"initialization-folder":"Templates","sort":100000},"wfrp4e-up-in-arms":{"initialization-folder":"Templates","sort":200000}},"system":{"description":{"type":"String","label":"Description","value":""},"gmdescription":{"type":"String","label":"Description","value":""},"rollable":{"value":false,"damage":false,"skill":"","label":"Rollable","type":"Boolean","rollCharacteristic":"","bonusCharacteristic":"","dice":"","defaultDifficulty":"challenging","SL":true,"attackType":"melee"},"specification":{"value":"","type":"String","label":"Specification"},"qualities":{"label":"Qualities","value":[]},"flaws":{"label":"Flaws","value":[]}},"_stats":{"systemId":"wfrp4e","systemVersion":"6.5.9","coreVersion":"10.303","createdTime":1670793141344,"modifiedTime":1688303321689,"lastModifiedBy":"QnM952ZqoCxWL1Ok"},"_id":"x5wpMprsObuqMCYg","folder":null,"sort":0,"ownership":{"default":0,"QnM952ZqoCxWL1Ok":3}}
